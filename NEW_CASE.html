<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TRACE | Add New Case</title>
  <link rel="icon" type="image/png" href="CENTRAL_GOVERNMENT.jpg" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { 
      margin:0; 
      padding:0; 
      box-sizing:border-box; 
      font-family:'Poppins', sans-serif; 
    }
    body, html { 
      height:100%; 
      background: linear-gradient(135deg,#0f0f0f,#1c1c1c);
      color: #fff;
    }
    .container {
      display:flex; 
      align-items:flex-start; 
      justify-content:center;
      padding:80px 20px 20px;
      min-height:100vh;
    }
    .form-container {
      background:rgba(255,255,255,0.1); 
      backdrop-filter:blur(15px);
      padding:30px; 
      border-radius:12px; 
      color:#fff;
      box-shadow:0 8px 32px rgba(0,0,0,0.3);
      display:grid;
      grid-template-columns: 1fr 2fr 2fr;
      gap:20px;
      width:100%; 
      max-width:1200px;
    }
    .form-container h2 {
      grid-column: 1 / -1;
      text-align:center; 
      color:#00f7ff; 
      margin-bottom:20px;
      font-size: 1.8rem;
    }
    .input-box { 
      margin-bottom:15px; 
    }
    .input-box label {
      display: block;
      margin-bottom: 5px;
      color: #00f7ff;
      font-size: 0.9rem;
    }
    .input-box input,
    .input-box textarea,
    .input-box select {
      width:100%; 
      padding:12px; 
      font-size:1rem;
      border-radius:6px; 
      border:1px solid rgba(255,255,255,0.2);
      background:rgba(0,0,0,0.3); 
      color:#fff; 
      outline:none;
      transition: border 0.3s;
    }
    .input-box input:focus,
    .input-box textarea:focus,
    .input-box select:focus {
      border-color: #00f7ff;
    }
    .input-box textarea { 
      resize:vertical; 
      min-height: 120px;
    }
    .submit-btn {
      grid-column: 1 / -1;
      padding:14px; 
      font-size:1rem; 
      font-weight:600;
      background:linear-gradient(90deg,#00f7ff,#007BFF);
      border:none; 
      border-radius:6px; 
      cursor:pointer;
      transition:all 0.3s;
      color: #000;
      margin-top: 10px;
    }
    .submit-btn:hover { 
      background:linear-gradient(90deg,#007BFF,#0056d2); 
      color:#fff; 
    }
    .submit-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }
    .cancel-btn {
      grid-column: 1 / -1; 
      text-align:center; 
      margin-top:10px;
    }
    .cancel-btn a {
      color:#00f7ff; 
      text-decoration:none;
      transition: color 0.3s;
    }
    .cancel-btn a:hover { 
      color: #fff;
    }
    .id-container {
      grid-column: 1 / -1;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .id-container input {
      flex: 1;
      padding: 12px;
    }
    .id-container button {
      padding: 12px 20px;
      background: linear-gradient(90deg, #00f7ff, #007BFF);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: #000;
      font-weight: 600;
      transition: all 0.3s;
    }
    .id-container button:hover {
      background: linear-gradient(90deg, #007BFF, #0056d2);
      color: #fff;
    }
    .file-upload-section {
      grid-column: 1 / -1;
      margin-bottom: 15px;
      padding: 15px;
      border: 1px dashed rgba(255,255,255,0.3);
      border-radius: 6px;
      background: rgba(0,0,0,0.2);
    }
    .file-upload-section h3 {
      margin-bottom: 10px;
      color: #00f7ff;
      font-size: 1.1rem;
    }
    .file-input {
      width: 100%;
      padding: 10px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      color: #fff;
    }
    .file-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    .file-preview-item {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 4px;
      overflow: hidden;
      background: rgba(255,255,255,0.1);
    }
    .file-preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .file-preview-item .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(255,0,0,0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }
    .file-preview-item .remove-btn:hover {
      background: rgba(255,0,0,0.9);
    }
    .file-preview-item .file-name {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 3px;
      font-size: 0.7rem;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .progress-container {
      grid-column: 1 / -1;
      margin-top: 15px;
      display: none;
    }
    .progress-bar {
      height: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 5px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      background: linear-gradient(90deg, #00f7ff, #007BFF);
      width: 0%;
      transition: width 0.3s ease;
    }
    .status-message {
      margin-top: 10px;
      color: #00f7ff;
      text-align: center;
      font-size: 0.9rem;
    }
    .error-message {
      color: #ff4444;
      font-size: 0.8rem;
      margin-top: 5px;
      display: none;
    }
    @media(max-width: 900px) {
      .form-container { 
        grid-template-columns: 1fr; 
        padding: 20px;
      }
      .container {
        padding: 20px 10px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <form class="form-container" id="add-case-form">
    <h2>Add New Case</h2>

    <div class="input-box" style="grid-column:1/-1;">
      <label for="case-id">Case ID</label>
      <div class="id-container">
        <input type="text" id="case-id" placeholder="Case ID" required />
        <button type="button" id="generate-id">Generate ID</button>
      </div>
      <div class="error-message" id="case-id-error"></div>
    </div>

    <div class="input-box">
      <label for="case-title">Case Title</label>
      <input type="text" id="case-title" placeholder="Case Title" required />
      <div class="error-message" id="case-title-error"></div>
    </div>

    <div class="input-box" style="grid-column:span 2;">
      <label for="case-description">Case Description</label>
      <textarea id="case-description" placeholder="Case Description" required></textarea>
      <div class="error-message" id="case-description-error"></div>
    </div>
     
    <div class="input-box">
  <label for="case-location">Location</label>
  <input type="text" id="case-location" placeholder="Case Location" required />
  <div class="error-message" id="case-location-error"></div>
</div>

<div class="input-box">
  <label for="case-date">Date and Time</label>
  <input type="datetime-local" id="case-date" required />
  <div class="error-message" id="case-date-error"></div>
</div>

<div class="input-box">
  <label for="witnesses">Witnesses</label>
  <input type="text" id="witnesses" placeholder="Witness names" />
</div>

<div class="input-box">
  <label for="victims">Victims</label>
  <input type="text" id="victims" placeholder="Victim names" />
</div>

<div class="input-box">
  <label for="suspects">Suspects </label>
  <input type="text" id="suspects" placeholder="Suspect names" />
</div>

    <div class="input-box">
      <label for="assigned-officer">Assigned Officer</label>
      <select id="assigned-officer" required>
        <option value="">Select Officer</option>
      </select>
      <div class="error-message" id="assigned-officer-error"></div>
    </div>
    
    <div class="input-box">
      <label for="assigned-inspector">Assigned Inspector</label>
      <select id="assigned-inspector" required>
        <option value="">Select Inspector</option>
      </select>
      <div class="error-message" id="assigned-inspector-error"></div>
    </div>
    
    <div class="input-box">
      <label for="assigned-hawaldar">Assigned Hawaldar</label>
      <select id="assigned-hawaldar" required>
        <option value="">Select Hawaldar</option>
      </select>
      <div class="error-message" id="assigned-hawaldar-error"></div>
    </div>
    
    <div class="input-box">
      <label for="forensics-expert">Forensics Expert</label>
      <select id="forensics-expert" required>
        <option value="">Select Forensics Expert</option>
      </select>
      <div class="error-message" id="forensics-expert-error"></div>
    </div>
    
    <div class="input-box">
      <label for="ballistics-expert">Ballistics Expert</label>
      <select id="ballistics-expert" required>
        <option value="">Select Ballistics Expert</option>
      </select>
      <div class="error-message" id="ballistics-expert-error"></div>
    </div>

    <div class="input-box">
      <label for="case-priority">Priority</label>
      <select id="case-priority" required>
        <option value="">Select Priority</option>
        <option value="High">High</option>
        <option value="Medium">Medium</option>
        <option value="Low">Low</option>
      </select>
      <div class="error-message" id="case-priority-error"></div>
    </div>

    <div class="input-box">
      <label for="case-status">Status</label>
      <select id="case-status" required>
        <option value="">Select Status</option>
        <option value="Open">Open</option>
        <option value="Closed">Closed</option>
        <option value="In Progress">In Progress</option>
      </select>
      <div class="error-message" id="case-status-error"></div>
    </div>

    <!-- Evidence Upload Section -->
    <div class="file-upload-section">
      <h3>Evidence Files</h3>
      <input type="file" id="case-evidence" class="file-input" multiple accept="image/*,.pdf,.doc,.docx,.txt" />
      <div class="file-preview" id="evidence-preview"></div>
      <div class="error-message" id="case-evidence-error"></div>
    </div>

    <!-- Forensics Upload Section -->
    <div class="file-upload-section">
      <h3>Forensics Files</h3>
      <input type="file" id="forensics-files" class="file-input" multiple accept="image/*,.pdf,.doc,.docx,.txt" />
      <div class="file-preview" id="forensics-preview"></div>
      <div class="error-message" id="forensics-files-error"></div>
    </div>

    <!-- Ballistics Upload Section -->
    <div class="file-upload-section">
      <h3>Ballistics Files</h3>
      <input type="file" id="ballistics-files" class="file-input" multiple accept="image/*,.pdf,.doc,.docx,.txt" />
      <div class="file-preview" id="ballistics-preview"></div>
      <div class="error-message" id="ballistics-files-error"></div>
    </div>

    <!-- Progress bar -->
    <div class="progress-container" id="progress-container">
      <div class="progress-bar">
        <div class="progress" id="progress-bar"></div>
      </div>
      <div class="status-message" id="status-message"></div>
    </div>

    <button type="submit" class="submit-btn">Add Case</button>

    <div class="cancel-btn">
      <a href="ADMIN_HOME.html">Cancel</a>
    </div>
  </form>
</div>

<script type="module">
  // Import Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { 
    getFirestore, 
    collection, 
    getDocs, 
    addDoc,
    doc,
    updateDoc,
    arrayUnion,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // Cloudinary configuration (replace with your actual values)
  const cloudinaryConfig = {
    cloudName: 'dh9caqgzv',
    uploadPreset: 'trace_uploads',
    apiKey: '598523176572148', // Get from Cloudinary dashboard
    folder: 'trace_uploads', // Organize files in Cloudinary
    evidenceFolder: 'evidence',
    forensicsFolder: 'forensics',
    ballisticsFolder: 'ballistics'
  };

  const firebaseConfig = {  
    apiKey: "AIzaSyC1bCHfPCiBpLXNdLev0TMkGGuAkqQywbQ",
    authDomain: "trace-601a4.firebaseapp.com",
    projectId: "trace-601a4",
    storageBucket: "trace-601a4.appspot.com",
    messagingSenderId: "492652025922",
    appId: "1:492652025922:web:935b8e7efe06be845ab5db",
    measurementId: "G-89T9DRMKZL"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Function to generate a random case ID
  function generateCaseId() {
    const prefix = 'CASE';
    const timestamp = Date.now().toString().slice(-6);
    const randomNum = Math.floor(1000 + Math.random() * 9000);
    return `${prefix}-${timestamp}-${randomNum}`;
  }

  // Generate ID button click handler
  document.getElementById('generate-id').addEventListener('click', () => {
    document.getElementById('case-id').value = generateCaseId();
  });

  // File preview and management functions
  function handleFilePreview(inputId, previewId) {
    const input = document.getElementById(inputId);
    const preview = document.getElementById(previewId);
    
    input.addEventListener('change', function(e) {
      preview.innerHTML = ''; // Clear previous previews
      
      if (this.files) {
        Array.from(this.files).forEach(file => {
          const previewItem = document.createElement('div');
          previewItem.className = 'file-preview-item';
          
          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove-btn';
          removeBtn.innerHTML = '×';
          removeBtn.addEventListener('click', () => {
            previewItem.remove();
            // Remove the file from the input's files list
            const newFileList = Array.from(input.files).filter(f => f !== file);
            const dataTransfer = new DataTransfer();
            newFileList.forEach(f => dataTransfer.items.add(f));
            input.files = dataTransfer.files;
          });
          
          const fileName = document.createElement('div');
          fileName.className = 'file-name';
          fileName.textContent = file.name;
          
          if (file.type.startsWith('image/')) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            previewItem.appendChild(img);
          } else {
            const fileTypeIcon = document.createElement('div');
            fileTypeIcon.style.display = 'flex';
            fileTypeIcon.style.alignItems = 'center';
            fileTypeIcon.style.justifyContent = 'center';
            fileTypeIcon.style.height = '100%';
            fileTypeIcon.style.fontSize = '2rem';
            
            // Simple file type icons
            if (file.type.includes('pdf')) {
              fileTypeIcon.innerHTML = '📄';
            } else if (file.type.includes('word') || file.name.endsWith('.doc') || file.name.endsWith('.docx')) {
              fileTypeIcon.innerHTML = '📝';
            } else if (file.type.includes('text') || file.name.endsWith('.txt')) {
              fileTypeIcon.innerHTML = '📄';
            } else {
              fileTypeIcon.innerHTML = '📁';
            }
            
            previewItem.appendChild(fileTypeIcon);
          }
          
          previewItem.appendChild(removeBtn);
          previewItem.appendChild(fileName);
          preview.appendChild(previewItem);
        });
      }
    });
  }

  // Initialize file previews
  handleFilePreview('case-evidence', 'evidence-preview');
  handleFilePreview('forensics-files', 'forensics-preview');
  handleFilePreview('ballistics-files', 'ballistics-preview');

  // Enhanced function to upload files to Cloudinary
  async function uploadToCloudinary(file, fileType) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', cloudinaryConfig.uploadPreset);
    
    // Set folder based on file type
    let folderPath = `${cloudinaryConfig.folder}/`;
    switch(fileType) {
      case 'evidence':
        folderPath += cloudinaryConfig.evidenceFolder;
        break;
      case 'forensics':
        folderPath += cloudinaryConfig.forensicsFolder;
        break;
      case 'ballistics':
        folderPath += cloudinaryConfig.ballisticsFolder;
        break;
      default:
        folderPath += 'other';
    }
    formData.append('folder', folderPath);
    
    // Add tags for better management
    formData.append('tags', `case_evidence,${fileType}`);
    
    try {
      const response = await fetch(
        `https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/upload`,
        {
          method: 'POST',
          body: formData
        }
      );
      
      if (!response.ok) {
        throw new Error(`Upload failed with status ${response.status}`);
      }
      
      const data = await response.json();
      return {
        url: data.secure_url,
        public_id: data.public_id,
        format: data.format,
        resource_type: data.resource_type,
        originalName: file.name,
        size: data.bytes,
        width: data.width || null,
        height: data.height || null,
        thumbnailUrl: generateThumbnailUrl(data.public_id, data.format),
        folder: folderPath,
        uploadedAt: new Date()
      };
    } catch (error) {
      console.error('Error uploading to Cloudinary:', error);
      throw error;
    }
  }

  // Generate thumbnail URL for images
  function generateThumbnailUrl(publicId, format) {
    return `https://res.cloudinary.com/${cloudinaryConfig.cloudName}/image/upload/w_200,h_200,c_fill/${publicId}.${format}`;
  }

  // Function to upload multiple files with progress
  async function uploadFiles(files, progressCallback) {
    const uploadPromises = [];
    const totalFiles = files.length;
    let uploadedCount = 0;
    
    for (const fileObj of files) {
      const uploadPromise = uploadToCloudinary(fileObj.file, fileObj.type)
        .then(result => {
          uploadedCount++;
          const progress = Math.round((uploadedCount / totalFiles) * 100);
          progressCallback(progress, `Uploading ${uploadedCount} of ${totalFiles} files...`);
          return {
            ...result,
            type: fileObj.type
          };
        })
        .catch(error => {
          console.error(`Error uploading file ${fileObj.file.name}:`, error);
          throw error;
        });
      
      uploadPromises.push(uploadPromise);
    }
    
    return Promise.all(uploadPromises);
  }

  // Populate user dropdowns
  async function populateDropdowns() {
    try {
      const usersRef = collection(db, "users");
      const usersSnapshot = await getDocs(usersRef);

      const officerSelect = document.getElementById("assigned-officer");
      const inspectorSelect = document.getElementById("assigned-inspector");
      const hawaldarSelect = document.getElementById("assigned-hawaldar");
      const forensicsSelect = document.getElementById("forensics-expert");
      const ballisticsSelect = document.getElementById("ballistics-expert");

      // Clear existing options (except the first one)
      [officerSelect, inspectorSelect, hawaldarSelect, forensicsSelect, ballisticsSelect].forEach(select => {
        while (select.options.length > 1) {
          select.remove(1);
        }
      });

      // Populate dropdowns based on position
      usersSnapshot.forEach(doc => {
        const user = doc.data();
        const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim();
        if (!fullName || !user.position) return;

        const option = document.createElement("option");
        option.value = doc.id;
        option.textContent = fullName;
        option.dataset.position = user.position;

        switch (user.position) {
          case "officer":
            officerSelect.appendChild(option.cloneNode(true));
            break;
          case "inspector":
            inspectorSelect.appendChild(option.cloneNode(true));
            break;
          case "hawaldar":
            hawaldarSelect.appendChild(option.cloneNode(true));
            break;
          case "forensics_expert":
            forensicsSelect.appendChild(option.cloneNode(true));
            break;
          case "ballistics_expert":
            ballisticsSelect.appendChild(option.cloneNode(true));
            break;
        }
      });

      // Sort options alphabetically
      [officerSelect, inspectorSelect, hawaldarSelect, forensicsSelect, ballisticsSelect].forEach(select => {
        const options = Array.from(select.options);
        options.sort((a, b) => a.text.localeCompare(b.text));
        select.innerHTML = '';
        select.appendChild(options[0]); // Keep placeholder
        options.slice(1).forEach(option => select.appendChild(option));
      });

    } catch (error) {
      console.error("Error fetching users:", error);
      alert("Failed to load user list. Please refresh the page.");
    }
  }

  // Initialize when DOM is ready
  window.addEventListener("DOMContentLoaded", () => {
    populateDropdowns();
    document.getElementById('case-id').value = generateCaseId();
  });

  // Form submission handler
  document.getElementById("add-case-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    
    // UI elements
    const progressContainer = document.getElementById('progress-container');
    const progressBar = document.getElementById('progress-bar');
    const statusMessage = document.getElementById('status-message');
    const submitBtn = e.target.querySelector('.submit-btn');
    
    // Show progress and disable button
    progressContainer.style.display = 'block';
    submitBtn.disabled = true;
    
    try {
      // Start progress
      progressBar.style.width = '5%';
      statusMessage.textContent = 'Starting upload process...';
      
      // Get all files to upload
      const evidenceFiles = document.getElementById('case-evidence').files;
      const forensicsFiles = document.getElementById('forensics-files').files;
      const ballisticsFiles = document.getElementById('ballistics-files').files;
      
      // Prepare files for upload
      const filesToUpload = [
        ...Array.from(evidenceFiles).map(file => ({ file, type: 'evidence' })),
        ...Array.from(forensicsFiles).map(file => ({ file, type: 'forensics' })),
        ...Array.from(ballisticsFiles).map(file => ({ file, type: 'ballistics' }))
      ];
      
      // Upload files to Cloudinary
      let uploadedFiles = [];
      if (filesToUpload.length > 0) {
        uploadedFiles = await uploadFiles(
          filesToUpload,
          (progress, message) => {
            progressBar.style.width = `${5 + (progress * 0.8)}%`;
            statusMessage.textContent = message;
          }
        );
      }
      
      // Update progress
      progressBar.style.width = '90%';
      statusMessage.textContent = 'Saving case details...';
      
      // Organize files by type
      const evidenceFilesData = uploadedFiles.filter(f => f.type === 'evidence');
      const forensicsFilesData = uploadedFiles.filter(f => f.type === 'forensics');
      const ballisticsFilesData = uploadedFiles.filter(f => f.type === 'ballistics');
      
      // Prepare case data for Firestore
      const caseData = {
        caseId: document.getElementById("case-id").value,
        title: document.getElementById("case-title").value,
        description: document.getElementById("case-description").value,
        location: document.getElementById("case-location").value,
  dateTime: document.getElementById("case-date").value,
  witnesses: document.getElementById("witnesses").value.split(',').map(w => w.trim()),
  victims: document.getElementById("victims").value.split(',').map(v => v.trim()),
  suspects: document.getElementById("suspects").value.split(',').map(s => s.trim()),
        assignedOfficer: document.getElementById("assigned-officer").value,
        assignedInspector: document.getElementById("assigned-inspector").value,
        assignedHawaldar: document.getElementById("assigned-hawaldar").value,
        forensicsExpert: document.getElementById("forensics-expert").value,
        ballisticsExpert: document.getElementById("ballistics-expert").value,
        priority: document.getElementById("case-priority").value,
        status: document.getElementById("case-status").value,
        evidenceFiles: evidenceFilesData,
        forensicsFiles: forensicsFilesData,
        ballisticsFiles: ballisticsFilesData,
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
        createdBy: 'current_user_id' // You should add your auth user ID here
      };

      // Save case to Firestore
      const casesRef = collection(db, "cases");
      const docRef = await addDoc(casesRef, caseData);
      console.log("Case added with ID: ", docRef.id);

      // Update assigned users
      const assignedPersonnel = [
        caseData.assignedOfficer,
        caseData.assignedInspector,
        caseData.assignedHawaldar,
        caseData.forensicsExpert,
        caseData.ballisticsExpert
      ].filter(Boolean); // Remove empty values

      for (const userId of assignedPersonnel) {
        const userRef = doc(db, "users", userId);
        await updateDoc(userRef, {
          assignedCases: arrayUnion(docRef.id),
          lastAssigned: serverTimestamp()
        });
      }
      
      // Complete progress
      progressBar.style.width = '100%';
      statusMessage.textContent = 'Case added successfully!';
      
      // Reset form after delay
      setTimeout(() => {
        alert("Case added successfully!");
        e.target.reset();
        document.getElementById('case-id').value = generateCaseId();
        progressContainer.style.display = 'none';
        ['evidence-preview', 'forensics-preview', 'ballistics-preview'].forEach(id => {
          document.getElementById(id).innerHTML = '';
        });
        submitBtn.disabled = false;
      }, 1000);

    } catch (error) {
      console.error("Error adding case: ", error);
      progressBar.style.width = '0%';
      statusMessage.textContent = 'Error adding case. Please try again.';
      progressContainer.style.backgroundColor = 'rgba(255, 0, 0, 0.1)';
      alert(`Error: ${error.message || 'Failed to add case'}`);
      submitBtn.disabled = false;
    }
  });
</script>
</body>
</html>